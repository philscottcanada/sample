# This is script for https://cloud.google.com/cloud-build/
steps:
# Install
- name: 'gcr.io/cloud-builders/yarn'
  args: ['install']
# # Lint
# - name: 'gcr.io/cloud-builders/yarn'
#   args: ['run', 'lint']
# # Test
# - name: 'gcr.io/cloud-builders/yarn'
#   args: ['run', 'unittest']
# Build
- name: 'gcr.io/cloud-builders/yarn'
  args: ['run', 'build']
  env:
  - 'REACT_APP_BACKEND_URL=https://sample-1613270266238.uc.r.appspot.com/'
  - 'NODE_PATH=./src'
# Deploy
- name: gcr.io/cloud-builders/gsutil
  #args: ["-m", "rsync", "-d", "-r", "build", "gs://${_FE_STAGING_BUCKET_NAME}"]
  args: ["-m", "rsync", "-d", "-r", "build", "gs://staging.sample-1613270266238.appspot.com]
# Grant public permission
# TODO: it should be remove, by setting default permissions for the bucket.
- name: gcr.io/cloud-builders/gsutil
  args: ["-m", "acl", "ch", "-u", "AllUsers:R", "gs://staging.sample-1613270266238.appspot.com/**"]